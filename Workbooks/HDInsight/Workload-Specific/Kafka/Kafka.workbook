{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# HDInsight Kafka Insights\r\n"
      },
      "name": "text - 13"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Cluster}"
        ],
        "parameters": [
          {
            "id": "4795985f-0816-4c2b-b62a-1bd32592eaa2",
            "version": "KqlParameterItem/1.0",
            "name": "Cluster",
            "type": 5,
            "isRequired": true,
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.hdinsight/clusters": true
              },
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "defaultValue": "value::1"
          },
          {
            "id": "d4b31cc2-42b2-4e10-839c-4497a93f250e",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "description": "The time range for which the below charts will be generated for",
            "isRequired": true,
            "value": {
              "durationMs": 300000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 259200000
            }
          },
          {
            "id": "f28db5b2-33ff-4903-a819-e3792b2d93da",
            "version": "KqlParameterItem/1.0",
            "name": "usage",
            "type": 1,
            "description": "Whether Cluster Selected has records in the selected workspace",
            "isRequired": true,
            "query": "let hasNonEmptyTable = (T:string, T2:string) \r\n{ \r\n   toscalar( \r\n   union isfuzzy=true \r\n   ( table(T) | take 1 | count as Count ),\r\n   ( table(T2) | take 1 | count as Count),\r\n   (print Count=0) \r\n   | summarize sum(Count) \r\n   ) > 1\r\n};\r\nlet TableName = 'HDInsightAmbariSystemMetrics';\r\nlet TableName2 = 'HDInsightAmbariClusterAlerts';\r\nprint  IsPresent=iif(hasNonEmptyTable(TableName,TableName2 ), \"present\", \"not present\")",
            "crossComponentResources": [
              "{Cluster}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.hdinsight/clusters"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.hdinsight/clusters"
      },
      "name": "parameters - 3"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "496f034a-fc6d-4fb9-aa1e-ef3283c8f9ee",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Kafka Metrics",
                  "subTarget": "KafkaMetrics",
                  "style": "link"
                },
                {
                  "id": "147c4325-cf0d-4481-881f-0de46ebb158d",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "JVM",
                  "subTarget": "JVM",
                  "style": "link"
                },
                {
                  "id": "c2831e58-4f4a-4c78-b584-67d534f3e3be",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "System Metrics",
                  "subTarget": "SystemMetrics",
                  "style": "link"
                },
                {
                  "id": "82011f50-187d-4748-89ba-0a263192680e",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Component Logs",
                  "subTarget": "ComponentLogs",
                  "style": "link"
                }
              ]
            },
            "name": "links - 26"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "b7b7b3c1-b0a8-4b82-a9f5-64e8d80cadfa",
                        "cellValue": "kafka_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Dataflow",
                        "subTarget": "Dataflow",
                        "style": "link"
                      },
                      {
                        "id": "ad61eaa5-fae7-4618-b931-9ce5c276e31c",
                        "cellValue": "kafka_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Partitions",
                        "subTarget": "Partitions",
                        "style": "link"
                      },
                      {
                        "id": "d1c4161c-fb72-48e4-a23a-755a54aa7f4e",
                        "cellValue": "kafka_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Replication",
                        "subTarget": "Replication",
                        "style": "link"
                      },
                      {
                        "id": "67bbd328-f24b-4f76-ab62-c822d7f98ffd",
                        "cellValue": "kafka_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Message Statistics",
                        "subTarget": "MessageStats",
                        "style": "link"
                      },
                      {
                        "id": "9f3072ab-de0f-4fe3-b0a6-d98bb851c35a",
                        "cellValue": "kafka_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Consumer Groups",
                        "subTarget": "ConsumerGroups",
                        "style": "link"
                      },
                      {
                        "id": "1c22d4f3-c6c1-4b74-99c9-1806d7b83dd5",
                        "cellValue": "kafka_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Log Directory",
                        "subTarget": "LogDirectory",
                        "style": "link"
                      },
                      {
                        "id": "636a5e9c-ff9b-41ef-b446-1062b157b327",
                        "cellValue": "kafka_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "REST Proxy",
                        "subTarget": "RestProxy",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "Kafka Parameters"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "## Data Flow Metrics"
                        },
                        "name": "text - 12"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"MessagesInPerSec\"\r\n| summarize avg(MetricValue) by  HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n|take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Incoming Messages Per Second",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 31,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Incoming Messages Per Second"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"TotalProduceRequestsPerSec\"\r\n| summarize avg(MetricValue) by  HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n|take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Produce Requests Per Second by Host",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 31,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Produce Requests Per Second by Host"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"TotalFetchRequestsPerSec\"\r\n| summarize avg(MetricValue) by  HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n|take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Fetch Requests Per Second by Host",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 31,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Fetch Requests Per Second by Host"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"BytesInPerSec\"\r\n| summarize AggregatedValue = avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Incoming Bytes Per Second",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 11,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Incoming Bytes Per Second",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"BytesOutPerSec\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Outgoing Bytes Per Second",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 11,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Outgoing Bytes Per Second",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"ReplicationBytesInPerSec\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Incoming Replication Bytes Per Second",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 11,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Incoming Replication Bytes Per Second",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"ReplicationBytesOutPerSec\"\r\n| summarize avg(MetricValue) by  HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Outgoing Replication Bytes Per Second",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 11,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Outgoing Replication Bytes Per Second",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "kafka_tab",
                    "comparison": "isEqualTo",
                    "value": "Dataflow"
                  },
                  "name": "Dataflow"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "## Partition Metrics"
                        },
                        "name": "text - 15"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"UnderReplicatedPartitions\"\r\n| summarize AggregatedValue = max(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n| summarize UnderReplicatedPartitions=sum(AggregatedValue) by bin(TimeGenerated, {TimeRange:grain})\r\n| order by TimeGenerated desc\r\n|take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Underreplicated Partitions",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Underreplicated Partitions",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"OfflinePartitionsCount\"\r\n| summarize LeaderCount = avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n| order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Offline Partitions",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "nodeIdField": "HostName",
                            "sourceIdField": "ClusterName",
                            "targetIdField": "LeaderCount",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "chartSettings": {
                            "showLegend": true
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Offline Partitions",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"PartitionCount\"\r\n| summarize LeaderCount = avg(MetricValue) by  HostName, bin(TimeGenerated,{TimeRange:grain})\r\n| order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Partition Count",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "nodeIdField": "HostName",
                            "sourceIdField": "ClusterName",
                            "targetIdField": "LeaderCount",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "chartSettings": {
                            "showLegend": true
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Partition Count",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"LeaderCount\"\r\n| summarize LeaderCount = avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n| order by TimeGenerated desc\r\n|take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Leader Count",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "nodeIdField": "HostName",
                            "sourceIdField": "ClusterName",
                            "targetIdField": "LeaderCount",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "chartSettings": {
                            "showLegend": true
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Leader Count",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"LeaderElectionRateAndTimeMs\"\r\n| summarize LeaderElectionRate = avg(MetricValue) by  bin(TimeGenerated, {TimeRange:grain})\r\n| order by TimeGenerated desc\r\n|take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Leader Election Rate in MS",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "nodeIdField": "HostName",
                            "sourceIdField": "ClusterName",
                            "targetIdField": "LeaderCount",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "chartSettings": {
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 23,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Leader Election Rate in MS",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"UncleanLeaderElectionsPerSec\"\r\n| summarize UncleanLeaderElectionPerSec = avg(MetricValue) by bin(TimeGenerated, {TimeRange:grain})\r\n| order by TimeGenerated desc\r\n|take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Unclean Leader Elections Per Second",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "nodeIdField": "HostName",
                            "sourceIdField": "ClusterName",
                            "targetIdField": "LeaderCount",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "chartSettings": {
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 31,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Unclean Leader Elections Per Second",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "kafka_tab",
                    "comparison": "isEqualTo",
                    "value": "Partitions"
                  },
                  "name": "Partitions"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "## Replication Metrics"
                        },
                        "name": "text - 18 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"ActiveControllerCount\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n\r\n\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Active Controller Count",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "name": "Active Controller Count"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"ReplicaMaxLag\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n\r\n\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Replica Max Lag",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Replica Max Lag"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"IsrExpandsPerSec\" or MetricName == \"IsrShrinksPerSec\"\r\n| summarize avg(MetricValue) by MetricName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n\r\n\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "ISR Shrink and Expand Rate",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 31,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "ISR Shrink and Expand Rate"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "kafka_tab",
                    "comparison": "isEqualTo",
                    "value": "Replication"
                  },
                  "name": "Replication"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "## Message Processing Metrics"
                        },
                        "name": "text - 18"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"ProduceMessageConversionsPerS\" or MetricName == \"FetchMessageConversionsPerSec\"\r\n| summarize LeaderCount = avg(MetricValue) by MetricName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Average Message Conversions Per Second",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "nodeIdField": "HostName",
                            "sourceIdField": "ClusterName",
                            "targetIdField": "LeaderCount",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "chartSettings": {
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 31,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Average Message Conversions Per Second",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName contains \"TotalTime\"\r\n| summarize avg(MetricValue) by MetricName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Average Message Type Total Time",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "nodeIdField": "HostName",
                            "sourceIdField": "ClusterName",
                            "targetIdField": "LeaderCount",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "chartSettings": {
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 23,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Average Message Type Total Time in MS"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName startswith \"Produce\" and  MetricName !contains \"Total\" and MetricName !contains \"MessageConversions\"\r\n| summarize avg(MetricValue) by MetricName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Average Produce Request Time",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "categoricalbar",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "nodeIdField": "HostName",
                            "sourceIdField": "ClusterName",
                            "targetIdField": "LeaderCount",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "chartSettings": {
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 23,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo",
                          "value": ""
                        },
                        "name": "Average Produce Request Time"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName startswith \"Fetch\" and  MetricName !contains \"Total\" and MetricName contains \"Consumer\" and  MetricName !contains \"Conversions\"\r\n| summarize avg(MetricValue) by MetricName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Average Consumer Fetch Request Time",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "categoricalbar",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "nodeIdField": "HostName",
                            "sourceIdField": "ClusterName",
                            "targetIdField": "LeaderCount",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "chartSettings": {
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 23,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Average Consumer Fetch  Request Time in MS"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName startswith \"Fetch\" and  MetricName !contains \"Total\" and MetricName contains \"Follower\" and  MetricName !contains \"Conversions\"\r\n| summarize avg(MetricValue) by MetricName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Average Follower Fetch Request Time",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "categoricalbar",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "ClusterName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "LeaderCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "nodeIdField": "HostName",
                            "sourceIdField": "ClusterName",
                            "targetIdField": "LeaderCount",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "chartSettings": {
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 23,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Average Follower Fetch  Request Time in MS - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "kafka_tab",
                    "comparison": "isEqualTo",
                    "value": "MessageStats"
                  },
                  "name": "Message Statistics"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "## Consumer Group Metrics"
                        },
                        "name": "text - 24"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName contains \"NumGroups\"\r\n| summarize sum(MetricValue) by MetricName, HostName, bin(TimeGenerated,{TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Consumer Group States",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "unstackedbar"
                        },
                        "name": "Consumer Group States"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"NumGroups\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated,{TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Consumer Groups Per Host",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "name": "Consumer Groups Per Host"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"NumGroupsDead\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated,{TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Dead Consumer Groups Per Host",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "name": "Dead Consumer Groups Per Host"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"NumGroupsStable\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated,{TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Stable Consumer Groups Per Host",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "name": "Stable Consumer Groups Per Host - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"NumGroupsEmpty\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated,{TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Empty Consumer Groups Per Host",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "name": "Empty Consumer Groups Per Host - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"NumGroupsPreparingRebalance\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated,{TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": " Consumer Groups Preparing for Rebalance Per Host",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "name": " Consumer Groups Preparing for Rebalance Per Host"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"NumGroupsCompletingRebalanc\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated,{TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": " Consumer Groups  Completing Rebalance Per Host",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "name": " Consumer Groups  Completing Rebalance Per Host"
                      }
                    ]
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "kafka_tab",
                      "comparison": "isEqualTo",
                      "value": "ConsumerGroups"
                    },
                    {
                      "parameterName": "Cluster",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "Consumer Groups"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "## Kafka Log Metrics"
                        },
                        "name": "text - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"OfflineLogDirectoryCount\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Offline Log Directory Count",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Offline Log Directory Count",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"LogFlushRateAndTimeMsMean\" or MetricName == \"LogFlushRateAndTimeMs99thPercentile\"\r\n| summarize avg(MetricValue) by MetricName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Log Flush Rate Mean and 99th Percentile",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 23,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              },
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Log Flush Rate Mean and 99th Percentile in MS",
                        "styleSettings": {
                          "maxWidth": "100%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"LogFlushRateAndTimeMs\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Log Flush Rate Per Host",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 23,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              },
                              "min": 0
                            }
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Log Flush Rate Per Host in MS"
                      }
                    ]
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "kafka_tab",
                      "comparison": "isEqualTo",
                      "value": "LogDirectory"
                    },
                    {
                      "parameterName": "Cluster",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "Log Management"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "REST Proxy Metrics",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "## Throughput Metrics"
                        },
                        "name": "text - 5"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook67b03ece-d5b6-4309-9734-ce6195ae0976",
                          "version": "MetricsItem/2.0",
                          "size": 4,
                          "chartType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "metricScope": 0,
                          "resourceParameter": "Cluster",
                          "resourceIds": [
                            "{Cluster}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.OpenConnections",
                              "aggregation": 1
                            },
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequestTime.p95",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequestTime.p95",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequest.m1_delta",
                              "aggregation": 1
                            },
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequest.m1_delta",
                              "aggregation": 1
                            }
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.OpenConnections",
                                "formatter": 1,
                                "formatOptions": {
                                  "customColumnWidthSetting": "35ch"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.OpenConnections Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequestTime.p95",
                                "formatter": 1,
                                "formatOptions": {
                                  "customColumnWidthSetting": "35ch"
                                },
                                "numberFormat": {
                                  "unit": 23,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequestTime.p95 Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequestTime.p95",
                                "formatter": 1,
                                "formatOptions": {
                                  "customColumnWidthSetting": "35ch"
                                },
                                "numberFormat": {
                                  "unit": 23,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequestTime.p95 Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequest.m1_delta",
                                "formatter": 1,
                                "formatOptions": {
                                  "customColumnWidthSetting": "35ch"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequest.m1_delta Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequest.m1_delta",
                                "formatter": 1,
                                "formatOptions": {
                                  "customColumnWidthSetting": "35ch"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequest.m1_delta Timeline",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000,
                            "labelSettings": [
                              {
                                "columnId": "Subscription"
                              },
                              {
                                "columnId": "Name"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.OpenConnections",
                                "label": "ConcurrentConnections (Sum)"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.OpenConnections Timeline",
                                "label": "ConcurrentConnections Timeline"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequestTime.p95",
                                "label": "Producer RequestLatency (Average)"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequestTime.p95 Timeline",
                                "label": "Producer RequestLatency Timeline"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequestTime.p95",
                                "label": "Consumer RequestLatency (Average)"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequestTime.p95 Timeline",
                                "label": "Consumer RequestLatency Timeline"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequest.m1_delta",
                                "label": "Producer RequestThroughput (Sum)"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequest.m1_delta Timeline",
                                "label": "Producer RequestThroughput Timeline"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequest.m1_delta",
                                "label": "Consumer RequestThroughput (Sum)"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequest.m1_delta Timeline",
                                "label": "Consumer RequestThroughput Timeline"
                              }
                            ]
                          }
                        },
                        "name": "metric - 10"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookd97f8b96-1670-4298-bc0b-5b7a8038c74b",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "metricScope": 0,
                          "resourceParameter": "Cluster",
                          "resourceIds": [
                            "{Cluster}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.MessagesIn.m1_delta",
                              "aggregation": 1,
                              "splitBy": null
                            }
                          ],
                          "title": "Producer Message Throughput in Messages per Second",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "metric - 1"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook0f1a2d5f-5107-4066-8b65-20f9a1dc1693",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "metricScope": 0,
                          "resourceParameter": "Cluster",
                          "resourceIds": [
                            "{Cluster}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.MessagesOut.m1_delta",
                              "aggregation": 1,
                              "splitBy": null
                            }
                          ],
                          "title": "Consumer Message Throughput in Messages Per Second",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "metric - 1"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook7e4d1496-eb9e-4f83-909d-417033fef009",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "metricScope": 0,
                          "resourceParameter": "Cluster",
                          "resourceIds": [
                            "{Cluster}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequest.m1_delta",
                              "aggregation": 1,
                              "splitBy": null
                            }
                          ],
                          "title": "Producer Request Throughput in Requests Per Second",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "metric - 2"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookf1b4dd5f-0bd2-4c66-8dd6-e16fee2c838d",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "metricScope": 0,
                          "resourceParameter": "Cluster",
                          "resourceIds": [
                            "{Cluster}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequest.m1_delta",
                              "aggregation": 1,
                              "splitBy": null
                            }
                          ],
                          "title": "Consumer Request Throughput in Requests Per Second",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "metric - 3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Latency Metrics"
                        },
                        "name": "text - 4"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookfaad11d4-5a56-43ba-b09f-b27b2ef803e7",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "metricScope": 0,
                          "resourceParameter": "Cluster",
                          "resourceIds": [
                            "{Cluster}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ProducerRequestTime.p95",
                              "aggregation": 4,
                              "splitBy": null
                            }
                          ],
                          "title": "Prodcuer Request Latency P95",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "metric - 6"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook87919327-128e-4d32-8829-c711a7477c8d",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "metricScope": 0,
                          "resourceParameter": "Cluster",
                          "resourceIds": [
                            "{Cluster}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.ConsumerRequestTime.p95",
                              "aggregation": 4,
                              "splitBy": null
                            }
                          ],
                          "title": "Consumer Request Latency P95",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "metric - 7"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## REST Proxy Connection Metrics"
                        },
                        "name": "text - 8"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookaf768ad4-9d80-468d-8617-e20bd3fc6ee7",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "metricScope": 0,
                          "resourceParameter": "Cluster",
                          "resourceIds": [
                            "{Cluster}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.hdinsight/clusters",
                              "metric": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.OpenConnections",
                              "aggregation": 1,
                              "splitBy": null
                            }
                          ],
                          "title": "REST Proxy Concurrent Connections",
                          "gridFormatType": 1,
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Name",
                              "formatter": 13
                            },
                            "leftContent": {
                              "columnMatch": "Value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource"
                                }
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.OpenConnections Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.OpenConnections",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": null
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "labelSettings": [
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.OpenConnections",
                                "label": "REST proxy ConcurrentConnections (Sum)"
                              },
                              {
                                "columnId": "microsoft.hdinsight/clusters-Availability-KafkaRestProxy.OpenConnections Timeline",
                                "label": "REST proxy ConcurrentConnections Timeline"
                              }
                            ]
                          }
                        },
                        "name": "metric - 9"
                      }
                    ]
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "Cluster",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "kafka_tab",
                      "comparison": "isEqualTo",
                      "value": "RestProxy"
                    }
                  ],
                  "name": "REST Proxy Metrics"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "KafkaMetrics"
            },
            "name": "Kafka Metrics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "252096f2-5d81-41b6-88a9-90b1924ae067",
                        "cellValue": "jvm_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Memory",
                        "subTarget": "Memory",
                        "preText": "Memory",
                        "style": "link"
                      },
                      {
                        "id": "b0e99bcc-480b-4763-8365-3bcdf0212013",
                        "cellValue": "jvm_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Garbage Collection",
                        "subTarget": "GarbageCollection",
                        "style": "link"
                      },
                      {
                        "id": "99c13813-bacd-4bb4-8054-b88d35a040a7",
                        "cellValue": "jvm_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "File Descriptors",
                        "subTarget": "FileDescriptors",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 12"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "JVM Memory",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"jvm_memoryheapused\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "JVM Heap Memory Usage",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "JVM Heap Memory Usage"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"jvm_memorynonheapused\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "JVM NonHeap Memory Usage",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "JVM NonHeap Memory Usage in Bytes"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"OS_FreePhysicalMemorySize\" or MetricName == \"OS_TotalPhysicalMemorySize\"\r\n| evaluate pivot(MetricName, avg(MetricValue), HostName, TimeGenerated)\r\n| summarize PercentFreePhysicalMemorySize = avg((OS_FreePhysicalMemorySize/OS_TotalPhysicalMemorySize)*100) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Free Physical Memory Percentage",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              },
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Free Physical Memory Percentage"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"OS_CommittedVirtualMemorySize\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Committed Virtual Memory Size",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              },
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Committed Virtual Memory Size in Bytes"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"OS_FreeSwapSize\" or MetricName == \"OS_TotalSwapSize\"\r\n| evaluate pivot(MetricName, avg(MetricValue), HostName, TimeGenerated)\r\n| summarize PercentFreePhysicalMemorySize = avg((OS_FreeSwapSize/OS_TotalSwapSize)*100) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Free Swap Space Percentage",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              },
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Free Swap Space Percentage"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "jvm_tab",
                    "comparison": "isEqualTo",
                    "value": "Memory"
                  },
                  "name": "JVM Memory"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "JVM File Descriptors",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"OS_OpenFileDescriptorCount\" or MetricName == \"OS_MaxFileDescriptorCount\"\r\n| evaluate pivot(MetricName, avg(MetricValue), HostName, TimeGenerated)\r\n| summarize PercentUsedFileDescriptor = avg((OS_OpenFileDescriptorCount/OS_MaxFileDescriptorCount)*100) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Open File Descriptor Percentage",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "name": "Open File Descriptor Percentage"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName contains \"OpenFileDescriptor\"\r\n| summarize avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Open File Descriptor Count Per Host",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "name": "Open File Descriptor Count Per Host"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "jvm_tab",
                    "comparison": "isEqualTo",
                    "value": "FileDescriptors"
                  },
                  "name": "JVM File Descriptors"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "JVM Garbage Collection",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName == \"GarbageCollectionYoungGenCount\"\r\n| where TimeGenerated {TimeRange}\r\n| make-series avg(MetricValue) default=double(null) on TimeGenerated in range({TimeRange:start} , {TimeRange:end}, {TimeRange:grain}) by HostName\r\n| extend filled_avg_metric_value = series_fill_forward(avg_MetricValue) \r\n| mv-expand TimeGenerated to typeof(datetime), filled_avg_metric_value to typeof(int)\r\n| order by HostName desc,TimeGenerated asc \r\n| extend RateOfChange = iif(prev(HostName) == HostName, (filled_avg_metric_value - prev(filled_avg_metric_value, 1))/60.0, filled_avg_metric_value/1.0)\r\n| project TimeGenerated, HostName, RateOfChange\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "JVM Garbage Collection Per Second By Host",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "JVM Garbage Collection Per Second By Host"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightKafkaMetrics\r\n| where MetricName contains \"GarbageCollection\"\r\n| evaluate pivot(MetricName, avg(MetricValue),TimeGenerated, ClusterName, HostName)\r\n| where TimeGenerated {TimeRange}\r\n| make-series avg(GarbageCollectionYoungGenCount) default=double(null), avg(GarbageCollectionYoungGenTime) default=double(null) on TimeGenerated in range({TimeRange:start} , {TimeRange:end}, {TimeRange:grain}) by HostName\r\n| extend filled_avg_count_value = series_fill_forward(avg_GarbageCollectionYoungGenCount), filled_avg_time_value = series_fill_forward(avg_GarbageCollectionYoungGenTime)\r\n| mv-expand TimeGenerated to typeof(datetime), filled_avg_count_value to typeof(double), filled_avg_time_value to typeof(double)\r\n| order by HostName desc,TimeGenerated asc \r\n| extend RateOfChange = iif(prev(HostName) == HostName, (filled_avg_time_value - prev(filled_avg_time_value, 1))/(filled_avg_count_value - prev(filled_avg_count_value, 1)) , filled_avg_time_value/filled_avg_count_value)\r\n| extend RateOfChangeNoNan = iif(isnan(RateOfChange), 0.0, RateOfChange)\r\n| project TimeGenerated, HostName, RateOfChangeNoNan\r\n\r\n\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "JVM Mean Time Per Collection in MS",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "Cluster",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "JVM Mean Time Per Collection in MS"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "jvm_tab",
                    "comparison": "isEqualTo",
                    "value": "GarbageCollection"
                  },
                  "name": "JVM Garbage Collection"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "JVM"
            },
            "name": "JVM Metrics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "System Metrics",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "623b56d9-85b7-4708-b6f5-096f91d8a697",
                        "cellValue": "metrics_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Disk",
                        "subTarget": "Disk",
                        "preText": "Disk",
                        "style": "link"
                      },
                      {
                        "id": "7906c8da-965b-4910-9823-44f4e17d40fa",
                        "cellValue": "metrics_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "CPU",
                        "subTarget": "CPU",
                        "style": "link"
                      },
                      {
                        "id": "9cf5e622-416e-4714-8f04-55e13dded4b4",
                        "cellValue": "metrics_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Memory",
                        "subTarget": "Memory",
                        "style": "link"
                      },
                      {
                        "id": "8e2525b1-e020-4f04-a2fc-d9154b2d3640",
                        "cellValue": "metrics_tab",
                        "linkTarget": "parameter",
                        "linkLabel": "Load",
                        "subTarget": "Load",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 4"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Disk",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| extend NodeType = substring(HostName,0,2)\r\n| summarize DiskPercentUsed = (1 - sum(DiskFree)/sum(DiskTotal))*100 by NodeType, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Disk Usage Percentage by Node Type",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "DiskPercentFree",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "percent",
                                    "useGrouping": false
                                  }
                                }
                              }
                            ]
                          },
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| summarize  DiskPercentUsed = (1 - sum(DiskFree)/sum(DiskTotal))*100, DiskUsedGB=avg(DiskTotal - DiskFree) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n| order by TimeGenerated, HostName desc\r\n| summarize arg_max(TimeGenerated, *) by HostName\r\n| sort by DiskPercentUsed desc\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Disk Used Percentage by Host",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "DiskPercentUsed",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumSignificantDigits": 3
                                  }
                                }
                              },
                              {
                                "columnMatch": "DiskUsedGB",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumFractionDigits": 2
                                  }
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "$gen_heatmap_DiskPercentUsed_2",
                                "sortOrder": 2
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_DiskPercentUsed_2",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "Disk Usage Per Host"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where TimeGenerated {TimeRange}\r\n| make-series avg(ReadCount) default=double(null) on TimeGenerated in range({TimeRange:start} , {TimeRange:end}, {TimeRange:grain}) by HostName\r\n| extend filled_avg_metric_value = series_fill_forward(avg_ReadCount) \r\n| mv-expand TimeGenerated to typeof(datetime), filled_avg_metric_value to typeof(int)\r\n| order by HostName desc,TimeGenerated asc \r\n| extend RateOfChange = iif(prev(HostName) == HostName, (filled_avg_metric_value - prev(filled_avg_metric_value, 1))/60.0, 0.0)\r\n| project TimeGenerated, HostName, RateOfChange",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Disk Read Count Per Second by Host",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "showPin": true,
                        "name": "Disk Read Count Per Second"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| where TimeGenerated {TimeRange}\r\n| make-series avg(WriteCount) default=double(null) on TimeGenerated in range({TimeRange:start} , {TimeRange:end}, {TimeRange:grain}) by HostName\r\n| extend filled_avg_metric_value = series_fill_forward(avg_WriteCount) \r\n| mv-expand TimeGenerated to typeof(datetime), filled_avg_metric_value to typeof(int)\r\n| order by HostName desc,TimeGenerated asc \r\n| extend RateOfChange = iif(prev(HostName) == HostName, (filled_avg_metric_value - prev(filled_avg_metric_value, 1))/60.0, 0.0)\r\n| project TimeGenerated, HostName, RateOfChange",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Disk Write Count Per Second by Host",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "showPin": true,
                        "name": "Disk Write Count Per Second by Host"
                      }
                    ]
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "Cluster",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "metrics_tab",
                      "comparison": "isEqualTo",
                      "value": "Disk"
                    }
                  ],
                  "name": "Disk"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "CPU Metrics",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| extend NodeType = substring(HostName,0,2)\r\n| summarize CPUUsagePercentage = avg(100 - CpuIdle) by NodeType, bin(TimeGenerated, {TimeRange:grain})\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "CPU Usage Percentage by Node Type",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "CPU Usage Percentage by Node Type"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| summarize CPUUsagePercentage = avg(100 - CpuIdle) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| summarize arg_max(TimeGenerated, *) by HostName\r\n| sort by CPUUsagePercentage desc",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "CPU Usage Percentage by Host",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "CPUUsagePercentage",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumSignificantDigits": 3
                                  }
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "$gen_heatmap_CPUUsagePercentage_2",
                                "sortOrder": 2
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_CPUUsagePercentage_2",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "customWidth": "50",
                        "showPin": true,
                        "name": "CPU Usage Percentage by Host"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "metrics_tab",
                    "comparison": "isEqualTo",
                    "value": "CPU"
                  },
                  "name": "CPU"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Memory Metrics",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| extend NodeType = substring(HostName,0,2)\r\n| summarize FreeMemory = avg(FreeMemory) by NodeType, bin(TimeGenerated, {TimeRange:grain})\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Free Memory in Bytes by Node Type",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "showPin": true,
                        "name": "Free Memory in Bytes by Node Type"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| summarize MemoryUsedPercentage = (1 - sum(FreeMemory)/sum(TotalMemory))*100 by  HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| summarize arg_max(TimeGenerated, *) by HostName\r\n| sort by MemoryUsedPercentage desc",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Memory Usage Percentage by Host",
                          "timeContext": {
                            "durationMs": 300000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "MemoryUsedPercentage",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumSignificantDigits": 3
                                  }
                                }
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "showPin": true,
                        "name": "Memory Usage Percentage by Host"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "metrics_tab",
                    "comparison": "isEqualTo",
                    "value": "Memory"
                  },
                  "name": "Memory"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Load Metrics",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| extend NodeType = substring(HostName,0,2)\r\n| summarize OneMinuteLoad = avg(OneMinuteLoad) by NodeType, bin(TimeGenerated, {TimeRange:grain})",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "One Minute Load by Node Type",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "name": "query - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| summarize OneMinuteLoad = avg(OneMinuteLoad) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| summarize arg_max(TimeGenerated, *) by HostName\r\n| sort by OneMinuteLoad desc",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "One Minute Load by Node",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "OneMinuteLoad",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "red"
                                }
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| extend NodeType = substring(HostName,0,2)\r\n| summarize FiveMinuteLoad = avg(FiveMinuteLoad) by NodeType, bin(TimeGenerated, {TimeRange:grain})",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Five Minute Load by Node Type",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "linechart"
                        },
                        "customWidth": "50",
                        "name": "query - 0 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightAmbariSystemMetrics\r\n| summarize FiveMinuteLoad = avg(FiveMinuteLoad) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| summarize arg_max(TimeGenerated, *) by HostName\r\n| sort by FiveMinuteLoad desc",
                          "size": 0,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Five Minute Load by Node",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.hdinsight/clusters",
                          "crossComponentResources": [
                            "{Cluster}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "FiveMinuteLoad",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "red"
                                }
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0 - Copy - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "metrics_tab",
                    "comparison": "isEqualTo",
                    "value": "Load"
                  },
                  "name": "Load"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "Cluster",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "SystemMetrics"
              }
            ],
            "name": "System Metrics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Zookeeper Metrics"
                  },
                  "name": "text - 24"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"ZooKeeperDisconnectsPerSec\" or MetricName == \"ZooKeeperExpiresPerSec\" or MetricName == \"ZooKeeperSyncConnectsPerS\"\r\n| summarize LeaderCount = avg(MetricValue) by MetricName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                    "size": 0,
                    "aggregation": 5,
                    "showAnalytics": true,
                    "title": "Zookeeper Operation Rates Per Second",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaceName}"
                    ],
                    "visualization": "linechart",
                    "chartSettings": {
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "Zookeeper Operation Rates Per Second"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"ZKRequestLatencyMs\"\r\n| summarize RequestLatency = avg(MetricValue) by HostName, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                    "size": 0,
                    "aggregation": 5,
                    "showAnalytics": true,
                    "title": "Zookeeper Client Request Latency",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaceName}"
                    ],
                    "visualization": "linechart",
                    "chartSettings": {
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 23,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "Zookeeper Client Request Latency in MS"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName == '{Cluster:label}'\r\n| where MetricName == \"ZKRequestLatencyMs99thPercentil\" or MetricName == \"ZKRequestLatencyMsMean\"\r\n| summarize avg(MetricValue) by MetricName, bin(TimeGenerated,{TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                    "size": 0,
                    "aggregation": 5,
                    "showAnalytics": true,
                    "title": "Zookeeper Client Request Mean and 99th Percentile Latency",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaceName}"
                    ],
                    "visualization": "linechart",
                    "chartSettings": {
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 23,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "Zookeeper Client Request Mean and 99th Percentile Latency in MS "
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "Zookeeper"
            },
            "name": "Zookeeper"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Kafka Server and Controller Logs",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Cluster}"
                    ],
                    "parameters": [
                      {
                        "id": "79c29bef-fb44-479a-bf22-5882894f4a11",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogType",
                        "type": 2,
                        "description": "Logs type for the log viewer and count graphic",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "HDInsightKafkaLogs\r\n| where TimeGenerated {TimeRange}\r\n| distinct LogType",
                        "crossComponentResources": [
                          "{Cluster}"
                        ],
                        "value": [
                          "value::all"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.hdinsight/clusters"
                      },
                      {
                        "id": "0c754d9c-7500-4604-9ab7-46e350f38593",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogLevel",
                        "type": 2,
                        "description": "Log Levels shown in the log viewer and log count graphic",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "HDInsightKafkaLogs\r\n| where TimeGenerated {TimeRange}\r\n| distinct LogLevel",
                        "crossComponentResources": [
                          "{Cluster}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.hdinsight/clusters"
                      },
                      {
                        "id": "b2e9f307-3338-4482-b531-cf0e71f857c9",
                        "version": "KqlParameterItem/1.0",
                        "name": "NumberOfLogs",
                        "type": 1,
                        "description": "Number of logs shown in log viewer",
                        "isRequired": true,
                        "value": "15",
                        "timeContext": {
                          "durationMs": 604800000
                        },
                        "timeContextFromParameter": "TimeRange"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.hdinsight/clusters"
                  },
                  "name": "Kafka Log Parameters"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaLogs\r\n| where LogType in ({LogType}) and LogLevel in ({LogLevel})\r\n| take {NumberOfLogs}\r\n| project TimeGenerated, LogType, LogLevel ,Message\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Kafka Log Viewer",
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.hdinsight/clusters",
                    "crossComponentResources": [
                      "{Cluster}"
                    ],
                    "visualization": "table"
                  },
                  "name": "Kafka Log Viewer"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaLogs\r\n| where LogType == '{LogType}'\r\n| summarize count() by LogLevel, bin(TimeGenerated, {TimeRange:grain})\r\n|order by TimeGenerated desc\r\n| take 10000",
                    "size": 0,
                    "aggregation": 5,
                    "showAnalytics": true,
                    "title": "Kafka Log Record Count",
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.hdinsight/clusters",
                    "crossComponentResources": [
                      "{Cluster}"
                    ],
                    "visualization": "linechart"
                  },
                  "name": "Kafka Log Count"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "Cluster",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "ComponentLogs"
              }
            ],
            "name": "Component Logs"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "usage",
        "comparison": "isEqualTo",
        "value": "present"
      },
      "name": "Usage"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "No Logs were found in your workspace. Please make sure that you have enabled Azure Monitor for your cluster.",
              "style": "info"
            },
            "name": "text - 0"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "usage",
        "comparison": "isEqualTo",
        "value": "not present"
      },
      "name": "No Usage"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}