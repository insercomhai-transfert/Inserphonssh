{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "a24f7f98-dc7a-42b2-b764-c9e99ff33754",
            "cellValue": "TabName",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "Overview",
            "style": "link"
          },
          {
            "id": "c46c1b48-bcd5-48f3-b515-44a2f3d78669",
            "cellValue": "TabName",
            "linkTarget": "parameter",
            "linkLabel": "Summary",
            "subTarget": "Summary",
            "style": "primary",
            "workbookContext": {
              "componentIdSource": "workbook",
              "resourceIdsSource": "workbook",
              "templateIdSource": "static",
              "templateId": "13bf0ff5-c132-4c85-910e-9de00bb3d26e",
              "typeSource": "workbook",
              "gallerySource": "workbook"
            }
          },
          {
            "id": "d82feaf3-d662-4fe9-b7c9-ab07bdba600f",
            "cellValue": "TabName",
            "linkTarget": "parameter",
            "linkLabel": "Backup Instances",
            "subTarget": "BackupItems",
            "style": "secondary",
            "workbookContext": {
              "componentIdSource": "workbook",
              "resourceIdsSource": "workbook",
              "templateIdSource": "static",
              "templateId": "Community-Workbooks/Azure Backup/Storage",
              "typeSource": "default",
              "gallerySource": "static",
              "gallery": "Azure Monitor"
            }
          },
          {
            "id": "0af01583-e55c-4b0a-a395-fd5037f30095",
            "cellValue": "TabName",
            "linkTarget": "parameter",
            "linkLabel": "Usage",
            "subTarget": "Usage",
            "style": "secondary",
            "workbookContext": {
              "componentIdSource": "workbook",
              "resourceIdsSource": "workbook",
              "templateIdSource": "static",
              "templateId": "Community-Workbooks/Azure Backup/Protected Instances",
              "typeSource": "default",
              "gallerySource": "static",
              "gallery": "Azure Monitor"
            }
          },
          {
            "id": "fbbecb40-83ec-4fe8-a5e0-973f8b14b22f",
            "cellValue": "TabName",
            "linkTarget": "parameter",
            "linkLabel": "Jobs",
            "subTarget": "JobDistribution",
            "style": "secondary",
            "workbookContext": {
              "componentIdSource": "workbook",
              "resourceIdsSource": "workbook",
              "templateIdSource": "static",
              "templateId": "Community-Workbooks/Azure Backup/Job Distribution",
              "typeSource": "default",
              "gallerySource": "static",
              "gallery": "Azure Monitor"
            }
          },
          {
            "id": "4101ac0a-663b-4c00-ad04-d5e0a9b5c126",
            "cellValue": "TabName",
            "linkTarget": "parameter",
            "linkLabel": "Policies",
            "subTarget": "PolicyDetails",
            "style": "link"
          },
          {
            "id": "883f8a53-19af-4f96-bce4-3e60c0d391e7",
            "cellValue": "TabName",
            "linkTarget": "parameter",
            "linkLabel": "Optimize",
            "subTarget": "Optimize",
            "style": "link"
          },
          {
            "id": "fd346de8-b14d-4ce9-9014-bcdf8c44b55a",
            "cellValue": "TabName",
            "linkTarget": "parameter",
            "linkLabel": "Policy Adherence",
            "subTarget": "Policy Adherence",
            "style": "link"
          }
        ]
      },
      "name": "Tabs"
    },
    {
      "type": 1,
      "content": {
        "json": "<div style=\"text-align:left;float:left;\"><span style=\"font-size:16px;font-weight:600\">Select Log Analytics Workspace </span> <br> <span style=\"font-size:12px;\"> <a href=\"https://aka.ms/AzureBackupDiagnosticsAutomationDoc\" target=\"_blank\"> How to configure vault diagnostic settings for backup reports </a> </span> </div> <div style=\"text-align:right; float:right\"> <span style=\"font-size:12px;\"> <a href=\"https://aka.ms/AzureBackupReportOld\" target=\"_blank\"> What happened to the Power BI reports? </a> </span> </div>"
      },
      "conditionalVisibility": {
        "parameterName": "TabName",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "name": "Overview-InstructionText"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspaces}"
        ],
        "parameters": [
          {
            "id": "d1f42f81-eb8f-4653-a0ff-38564d7487b4",
            "version": "KqlParameterItem/1.0",
            "name": "Subscriptions",
            "type": 6,
            "description": "Subscriptions to filter the list of workspaces",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": false,
              "selectAllValue": ""
            }
          },
          {
            "id": "2373a24f-ad32-4909-a7f6-59b373dcde6c",
            "version": "KqlParameterItem/1.0",
            "name": "Workspaces",
            "type": 5,
            "description": "LA Workspaces configured in vault diagnostic settings",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "where type =~ 'microsoft.operationalinsights/workspaces' | project id",
            "crossComponentResources": [
              "{Subscriptions}"
            ],
            "value": [],
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "64dd748f-d528-4912-a3bf-4a503e0b17f6",
            "version": "KqlParameterItem/1.0",
            "name": "VaultsUsingAzureDiagnostics",
            "type": 1,
            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday(ago(3d));\r\nlet RangeEnd = startofday(now());\r\nlet VaultSubscriptionList = \"*\";\r\nlet VaultLocationList = \"*\"; \r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent_1 = false;\r\nlet ExcludeLegacyEvent_2 = true;\r\n// calling LA System Function\r\n_AzureBackup_GetVaults(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent_1) | distinct Id\r\n| join kind = leftanti ( \r\n// calling LA System Function\r\n_AzureBackup_GetVaults(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent_2) | distinct Id) on Id\r\n| count ",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "d894d309-7e5f-488e-afde-73796c84b711",
            "version": "KqlParameterItem/1.0",
            "name": "AzureStorageCutOffDate",
            "type": 1,
            "description": "Cut-off Date To Enable AzureStorage",
            "isRequired": true,
            "query": "{\"version\":\"1.0.0\",\"content\":\"\\\"5/14/2020, 12:00:00.000 AM\\\"\",\"transformers\":null}",
            "isHiddenWhenLocked": true,
            "queryType": 8
          }
        ],
        "style": "above",
        "doNotRunWhenHidden": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "TabName",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "customWidth": "50",
      "name": "Overview-WorkspaceParameterBlock"
    },
    {
      "type": 1,
      "content": {
        "json": "You have vault(s) using **legacy diagnostics settings**. Please use the latest diagnostics settings for all your vaults to make them eligible for reporting upgrades. [Learn more](https://aka.ms/AzureBackupUseResourceSpecific)",
        "style": "warning"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Overview"
        },
        {
          "parameterName": "VaultsUsingAzureDiagnostics",
          "comparison": "isNotEqualTo",
          "value": ""
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "ResourceSpecificTextBox1"
    },
    {
      "type": 1,
      "content": {
        "json": "_____"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Overview"
        }
      ],
      "name": "Overview-DividingLine1"
    },
    {
      "type": 1,
      "content": {
        "json": "<div style=\"text-align:left;float:left;\"><span style=\"font-size:16px;font-weight:600\">Report Filters </span> </div> <div style=\"text-align:right; float:right\"> <span style=\"font-size:12px;\"> <a href=\"https://aka.ms/AzureBackupReportDocs\" target=\"_blank\"> How to use backup reports? </a> </span> </div>"
      },
      "conditionalVisibility": {
        "parameterName": "Workspaces",
        "comparison": "isNotEqualTo"
      },
      "name": "Overview-ReportFiltersTitle"
    },
    {
      "type": 1,
      "content": {
        "json": "<p> <span style=\"font-size:12px; font-style:italic\"> Filters are applied left to right and top to bottom on each page. <a href=\"https://aka.ms/AzureBackupReportFilters\" target=\"_blank\">Learn More</a> </span> </p>"
      },
      "conditionalVisibility": {
        "parameterName": "Workspaces",
        "comparison": "isNotEqualTo"
      },
      "name": "Overview-InstructionText2"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspaces}"
        ],
        "parameters": [
          {
            "id": "8c4ae44c-fa9a-4498-aedc-736a56e64b43",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "description": "Time Range",
            "value": {
              "durationMs": 604800000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange"
          },
          {
            "id": "bb7c8d78-cf0c-4b47-af95-1c07ac0f6829",
            "version": "KqlParameterItem/1.0",
            "name": "ErrorHandle",
            "label": "Error Handle",
            "type": 1,
            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = \"*\";\r\nlet VaultLocationList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet VaultList = \"*\";\r\nlet ExcludeLegacyEvent = false;\r\nlet BackupSolutionList = \"*\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search = \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = false;\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| distinct DatasourceType",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "78c86854-fe3c-44c5-8ee3-23d4210827d1",
            "version": "KqlParameterItem/1.0",
            "name": "ExcludeLegacyEvent",
            "label": "Exclude Legacy Table",
            "type": 2,
            "description": "Use this parameter to avoid querying data that is sent to the legacy Azure Diagnostics table. Excluding the legacy table improves query performance time. <a href=\"https://docs.microsoft.com/azure/backup/backup-azure-diagnostic-events#legacy-event\">Learn more </a>",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    { \"value\":\"True\",  \"selected\":true},\r\n    { \"value\":\"False\"}\r\n]",
            "value": "False"
          }
        ],
        "style": "above",
        "doNotRunWhenHidden": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "Workspaces",
        "comparison": "isNotEqualTo"
      },
      "customWidth": "36",
      "name": "Overview-TimeRangeParameterBlock",
      "styleSettings": {
        "maxWidth": "100%"
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "8ce61d1d-e371-40bf-ad53-7ba78afb976f",
            "version": "KqlParameterItem/1.0",
            "name": "DatasourceType",
            "label": "Backup Solution",
            "type": 2,
            "description": "Use to filter reports by backup solution",
            "isRequired": true,
            "multiSelect": true,
            "quote": "",
            "delimiter": ",",
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "jsonData": "\r\n[    \r\n{ \"value\": \"Azure Backup Agent\", \t\t\t\t\t\t\"label\": \"Azure Backup Agent\" },\r\n{ \"value\": \"Azure Backup Server\", \t\t\t\"label\": \"Azure Backup Server\" },\r\n{ \"value\": \"Azure Storage (Azure Files) Backup\", \t\t\t\t\"label\": \"Azure Storage (Azure Files) Backup\" },\r\n{ \"value\": \"Azure Virtual Machine Backup\", \t\t\t\t\t\t\"label\": \"Azure Virtual Machine Backup\" },\r\n{ \"value\": \"DPM\", \t\t\t\t\t\t\"label\": \"DPM\" },\r\n{ \"value\": \"SAP HANA in Azure VM Backup\", \"label\": \"SAP HANA in Azure VM Backup\" },\r\n{ \"value\": \"SQL in Azure VM Backup\",     \"label\": \"SQL in Azure VM Backup\" }\r\n]"
          },
          {
            "id": "678680e5-76b5-4db8-bbef-5f73942caf2e",
            "version": "KqlParameterItem/1.0",
            "name": "VaultSubscription",
            "label": "Subscription Name",
            "type": 6,
            "description": "Subscription(s) under which the vault(s) exist",
            "isRequired": true,
            "multiSelect": true,
            "quote": "",
            "delimiter": ",",
            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = \"*\";\r\nlet VaultLocationList = \"*\";\r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = false;\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| distinct VaultSubscriptionId",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "2a83acc5-2123-476f-8a4c-da2fddf231a1",
            "version": "KqlParameterItem/1.0",
            "name": "VaultLocation",
            "label": "Vault Location",
            "type": 2,
            "description": "Location(s) in which the vault(s) were created",
            "isRequired": true,
            "multiSelect": true,
            "quote": "",
            "delimiter": ",",
            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = \"*\";\r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = false;\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| distinct VaultLocation",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "fefd31fa-2774-43ca-8cc3-44d477c969f0",
            "version": "KqlParameterItem/1.0",
            "name": "VaultName",
            "label": "Vault Name",
            "type": 2,
            "description": "Name(s) of the vault(s)",
            "isRequired": true,
            "multiSelect": true,
            "quote": "",
            "delimiter": ",",
            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\n// calling LA System Function\r\n_AzureBackup_GetVaults(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent)\r\n// query to transform function output\r\n| distinct Name ",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "above",
        "doNotRunWhenHidden": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo",
          "value": ""
        }
      ],
      "customWidth": "64",
      "name": "Overview-ReportParameterBlock",
      "styleSettings": {
        "maxWidth": "100%"
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "parameters": [
          {
            "id": "3c5a3e26-bce4-43d9-a22d-e963a0d734af",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroupId",
            "type": 1,
            "query": "resources | where type==\"microsoft.operationalinsights/workspaces\" | project name, resourceGroupId=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup) | where \"{Workspaces}\" contains name | project resourceGroupId | take 1",
            "crossComponentResources": [
              "{Subscriptions}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "897957ad-a946-4b3b-98f0-02008d30ff0f",
            "version": "KqlParameterItem/1.0",
            "name": "WorkspaceName",
            "type": 1,
            "query": "resources | where type==\"microsoft.operationalinsights/workspaces\" \r\n| project name, resourceGroupId=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup) \r\n| where \"{Workspaces}\" contains name \r\n| where \"{ResourceGroupId}\" has resourceGroupId\r\n| take 1\r\n",
            "crossComponentResources": [
              "{Subscriptions}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "5327529a-bd07-4305-bf65-4b36a3c787b9",
            "version": "KqlParameterItem/1.0",
            "name": "LogicApp_VaultSubscriptionList",
            "type": 1,
            "query": "let VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nprint strcat(\"\\\"\",VaultSubscriptionList,\"\\\"\")",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "e404488a-5db7-42ba-9b44-996f1d8cd7b2",
            "version": "KqlParameterItem/1.0",
            "name": "LogicApp_VaultLocationList",
            "type": 1,
            "query": "let VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nprint strcat(\"\\\"\",VaultLocationList,\"\\\"\")",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "8005c310-7839-42ff-a3a4-01e5a6c45223",
            "version": "KqlParameterItem/1.0",
            "name": "LogicApp_VaultList",
            "type": 1,
            "query": "let VaultList = todynamic( @\"{VaultName}\"); \r\nprint strcat(\"\\\"\",VaultList,\"\\\"\")",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "2e3d4cd7-7393-4cc4-ab9e-793311eb291c",
            "version": "KqlParameterItem/1.0",
            "name": "LogicApp_DatasourceTypeList",
            "type": 1,
            "query": "let BackupSolutionList = @\"{DatasourceType}\";\r\nprint strcat(\"\\\"\",BackupSolutionList,\"\\\"\")",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "376631ff-44ae-4824-b470-ac32d82cd4f2",
            "version": "KqlParameterItem/1.0",
            "name": "LogicApp_ExcludeLegacyEvent",
            "type": 1,
            "query": "let ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nprint ExcludeLegacyEvent",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "LogicApp_RangeStart",
            "type": 1,
            "query": "let RangeStart = startofday({TimeRange:start});\r\nprint RangeStart",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "id": "4a81a315-11ac-41a7-a150-d9c97d122b99"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "LogicApp_RangeEnd",
            "type": 1,
            "query": "let RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nprint RangeEnd",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "id": "648dc7f4-4a01-4fa3-a621-549512842dd1"
          },
          {
            "id": "5d1a9bc1-34ab-491d-bfa6-f7fc8402f3dc",
            "version": "KqlParameterItem/1.0",
            "name": "LogicApp_AggregationType",
            "type": 1,
            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nprint strcat(\"\\\"\",AggregationType=iff(datetime_diff('day',RangeEnd,RangeStart)<=30,\"Daily\",iff(datetime_diff('day',RangeEnd,RangeStart)<=90,\"Weekly\",\"Monthly\")),\"\\\"\")\r\n\r\n\r\n\r\n\r\n\r\n",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "above",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo",
          "value": ""
        }
      ],
      "customWidth": "60",
      "name": "Overview-ReportParameterBlock - Copy",
      "styleSettings": {
        "maxWidth": "100%"
      }
    },
    {
      "type": 1,
      "content": {
        "json": "<span style=\"font-size:12px;font-style:italic\"> All datetimes are in UTC. Data for the current partial day is not shown in the reports. <a href=\"https://aka.ms/AzureBackupReportTimezone\" target=\"_blank\">Learn More</a></span></div>"
      },
      "conditionalVisibility": {
        "parameterName": "Workspaces",
        "comparison": "isNotEqualTo"
      },
      "name": "Overview-InstructionText2",
      "styleSettings": {
        "margin": "0% 0% 0% 0%",
        "padding": "0% 0% 0% 0%"
      }
    },
    {
      "type": 1,
      "content": {
        "json": "________________"
      },
      "conditionalVisibility": {
        "parameterName": "TabName",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "name": "Overview-DividingLine2"
    },
    {
      "type": 1,
      "content": {
        "json": "<div style=\"text-align:center;\"><span style=\"font-size:14px;font-weight:600;\"> Welcome to Azure Backup Reports! </span> <br> <br> <span style=\"font-size:12px;font-weight:600;\"> Select your Workspace(s) and click the Summary Tab above to get started </span> </div>"
      },
      "conditionalVisibility": {
        "parameterName": "TabName",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "name": "Overview-WelcomeText1"
    },
    {
      "type": 1,
      "content": {
        "json": "<div style=\"text-align:center;\"><span style=\"font-size:12px;font-weight:500;\"> <u>Salient Features</u> </span>  <span style=\"font-size:12px;font-weight:400;\"> <br><br>  View reports across workload types, subscriptions and regions <br><br> View reports across your tenants using Azure Lighthouse <br><br> Track and forecast usage both at a vault and backup item level <br><br> Analyze trends on jobs, backup items, policies, and more <br><br> Audit backups and restores for all your backup items\r\n</span> <br> </div>"
      },
      "conditionalVisibility": {
        "parameterName": "TabName",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "name": "Overview-WelcomeText2"
    },
    {
      "type": 1,
      "content": {
        "json": "You have vault(s) using **legacy diagnostics settings**. Please use the latest diagnostics settings for all your vaults to make them eligible for reporting upgrades. <a href=\"https://aka.ms/AzureBackupUseResourceSpecific\" target=\"_blank\">Learn More</a>",
        "style": "warning"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "TabName",
          "comparison": "isNotEqualTo",
          "value": "Overview"
        },
        {
          "parameterName": "VaultsUsingAzureDiagnostics",
          "comparison": "isNotEqualTo",
          "value": ""
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "ResourceSpecificTextBox2"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspaces}"
        ],
        "parameters": [
          {
            "id": "396c89aa-fd11-4736-8eb9-40c10a04be21",
            "version": "KqlParameterItem/1.0",
            "name": "AggregationType",
            "type": 1,
            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nprint AggregationType=iff(datetime_diff('day',RangeEnd,RangeStart)<=30,\"Daily\",iff(datetime_diff('day',RangeEnd,RangeStart)<=90,\"Weekly\",\"Monthly\"))\r\n\r\n",
            "crossComponentResources": [
              "{Workspaces}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "AggregationTypeParam"
    },
    {
      "type": 1,
      "content": {
        "json": "There is no backup data in the selected Log Analytics workspace(s) for the selected time range. <a href=\"https://aka.ms/UsingLAWorkspace\" target=\"_blank\">Learn More</a>",
        "style": "error"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "ErrorHandle",
          "comparison": "isEqualTo"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "Overview-ErrorMessage1"
    },
    {
      "type": 1,
      "content": {
        "json": "__________________________________________________________________________________________"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "CustomBackupManagementTypeParam",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "Overview-DividingLine2",
      "styleSettings": {
        "padding": "0px 0px 10px 0px"
      }
    },
    {
      "type": 1,
      "content": {
        "json": "_________________"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "text - 73"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "community-Workbooks/Azure Backup/policyadherence-tab",
        "items": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Policy Adherence"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "PolicyAdherence-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "community-Workbooks/Azure Backup/policydetails-tab",
        "items": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "PolicyDetails"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "policy-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "community-Workbooks/Azure Backup/jobdistribution-tab",
        "items": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "JobDistribution"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "jobs-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "community-Workbooks/Azure Backup/usage-tab",
        "items": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Usage"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "usage-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "community-Workbooks/Azure Backup/backupitems-tab",
        "items": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "BackupItems"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "backupitems-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "community-Workbooks/Azure Backup/summary-tab",
        "items": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Summary"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "summary-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "community-Workbooks/Azure Backup/optimize-tab",
        "items": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Optimize"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "Optimize-group"
    },
    {
      "type": 1,
      "content": {
        "json": "The below grid is displayed in **Weekly view** due to your time range selection. Backup Instances which have had **atleast one successful backup** on **every day** in a given week fall under the second column in the below table.  [Learn more](https://aka.ms/AzureBackupReportDailyBackupWeeklyView1)",
        "style": "info"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
          "comparison": "isEqualTo",
          "value": "Daily"
        },
        {
          "parameterName": "PolicyAdherence_SubTab",
          "comparison": "isEqualTo",
          "value": "Policy Adherence by Time Period"
        },
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Policy Adherence"
        },
        {
          "parameterName": "AggregationType",
          "comparison": "isEqualTo",
          "value": "Weekly"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "PolicyAdherenceByTimePeriod-DailyBackup-AggregationType-Weekly-Text"
    },
    {
      "type": 1,
      "content": {
        "json": "The below grid is displayed in **Weekly view** due to your time range selection. Backup Instances which have had **atleast one successful backup** on **every day** in a given week are marked green (compliant) for that week.  [Learn more](https://aka.ms/AzureBackupReportDailyBackupWeeklyView2)",
        "style": "info"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
          "comparison": "isEqualTo",
          "value": "Daily"
        },
        {
          "parameterName": "PolicyAdherence_SubTab",
          "comparison": "isEqualTo",
          "value": "Policy Adherence by Backup Instance"
        },
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Policy Adherence"
        },
        {
          "parameterName": "AggregationType",
          "comparison": "isEqualTo",
          "value": "Weekly"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "PolicyAdherenceByBackupInstance-DailyBackup-AggregationType-Weekly-Text"
    },
    {
      "type": 1,
      "content": {
        "json": "The below grid is displayed in **Monthly view** due to your time range selection. Backup Instances which have had **atleast one successful backup** on **every day** in a given month fall under the second column in the below table. Note that 'month' here refers to a span of 4 weeks (28 days). [Learn more](https://aka.ms/AzureBackupReportDailyBackupMonthlyView1)",
        "style": "info"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
          "comparison": "isEqualTo",
          "value": "Daily"
        },
        {
          "parameterName": "PolicyAdherence_SubTab",
          "comparison": "isEqualTo",
          "value": "Policy Adherence by Time Period"
        },
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Policy Adherence"
        },
        {
          "parameterName": "AggregationType",
          "comparison": "isEqualTo",
          "value": "Monthly"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "PolicyAdherenceByTimePeriod-DailyBackup-AggregationType-Monthly-Text"
    },
    {
      "type": 1,
      "content": {
        "json": "The below grid is displayed in **Monthly view** due to your time range selection. Backup Instances which have had **atleast one successful backup** on **every day** in a given month are marked green (compliant) for that month. Note that 'month' here refers to a span of 4 weeks (28 days). [Learn more](https://aka.ms/AzureBackupReportDailyBackupMonthlyView1)",
        "style": "info"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
          "comparison": "isEqualTo",
          "value": "Daily"
        },
        {
          "parameterName": "PolicyAdherence_SubTab",
          "comparison": "isEqualTo",
          "value": "Policy Adherence by Backup Instance"
        },
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Policy Adherence"
        },
        {
          "parameterName": "AggregationType",
          "comparison": "isEqualTo",
          "value": "Monthly"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "PolicyAdherenceByBackupInstance-DailyBackup-AggregationType-Monthly-Text"
    },
    {
      "type": 1,
      "content": {
        "json": "The below grid is displayed in **Monthly view** due to your time range selection. Backup Instances which have had **atleast one** successful backup in **every week** in a given month fall under the second column in the below table. Note that 'month' here refers to a span of 4 weeks (28 days). [Learn more](https://aka.ms/AzureBackupReportWeeklyBackupMonthlyView1)",
        "style": "info"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
          "comparison": "isEqualTo",
          "value": "Weekly"
        },
        {
          "parameterName": "PolicyAdherence_SubTab",
          "comparison": "isEqualTo",
          "value": "Policy Adherence by Time Period"
        },
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Policy Adherence"
        },
        {
          "parameterName": "AggregationType",
          "comparison": "isEqualTo",
          "value": "Monthly"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "PolicyAdherenceByTimePeriod-WeeklyBackup-AggregationType-Monthly-Text"
    },
    {
      "type": 1,
      "content": {
        "json": "The below grid is displayed in **Monthly view** due to your time range selection. Backup Instances which have had **atleast one** successful backup in **every week** in a given month are marked green (compliant) for that month. Note that 'month' here refers to a span of 4 weeks (28 days). [Learn more](https://aka.ms/AzureBackupReportWeeklyBackupMonthlyView2)",
        "style": "info"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
          "comparison": "isEqualTo",
          "value": "Weekly"
        },
        {
          "parameterName": "PolicyAdherence_SubTab",
          "comparison": "isEqualTo",
          "value": "Policy Adherence by Backup Instance"
        },
        {
          "parameterName": "TabName",
          "comparison": "isEqualTo",
          "value": "Policy Adherence"
        },
        {
          "parameterName": "AggregationType",
          "comparison": "isEqualTo",
          "value": "Monthly"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "PolicyAdherenceByBackupInstance-WeeklyBackup-AggregationType-Monthly-Text"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet BackupInstanceName = @\"{PolicyAdherence_DailyBackup_BackupInstanceFriendlyName}\";\r\nlet DatasourceSetName = @\"{PolicyAdherence_DailyBackup_DatasourceSetFriendlyName}\";\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\nlet PolicyAdherence_DailyOrWeeklyBackup_Value = @\"{PolicyAdherence_DailyOrWeeklyBackup}\";\r\nlet BackupInstanceWithSelectedBackupFrequency = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == PolicyAdherence_DailyOrWeeklyBackup_Value\r\n};\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithSelectedBackupFrequency) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| extend TempColumn = column_ifexists(tostring('{PolicyAdherenceTab_SortBy_2a}'), \"DataTransferredInMBs\")\r\n| extend ColumnToBeSorted = iff(tostring('{PolicyAdherenceTab_Order_2a}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, UniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{PolicyAdherenceTab_RowsPerPage_2a} + 1))\r\n| where page_num has ('{PolicyAdherenceTab_Page_2a}') or '*' in ('{PolicyAdherenceTab_Page_2a}')\r\n| project BackupInstance=BackupInstanceFriendlyName, BackupInstanceId, Container=DatasourceSetFriendlyName, ResourceGroup=iff(DatasourceType==\"Azure Backup Agent\" or DatasourceType==\"Azure Backup Server\" or DatasourceType==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]\r\n), OperationCategory, JobStatus=Status,  JobStartDateTime=StartTime, JobDuration=Duration_In_Secs/3600, DataTransferred=DataTransferredInMBs, AzureResource=DatasourceSetResourceId, DatasourceType \r\n",
        "size": 0,
        "title": "List of Jobs in Period",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspaces}"
        ],
        "sortBy": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "PolicyAdherence_DailyBackup_BackupInstanceFriendlyName",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "PolicyAdherence_WeeklyBackup_DatasourceSetFriendlyName",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "Workspaces",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "DatasourceType",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ErrorHandle",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "PolicyAdherence-DailyBackup-Grid2"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}