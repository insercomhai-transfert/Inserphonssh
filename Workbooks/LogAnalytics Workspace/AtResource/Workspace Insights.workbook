{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Resource}"
        ],
        "parameters": [
          {
            "id": "51f4ef42-018a-48b9-a561-39bc3fcf883c",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "value": {
              "durationMs": 86400000
            },
            "label": "Time Range"
          },
          {
            "id": "77adbf54-fe23-4d78-8721-0611d01b0d33",
            "version": "KqlParameterItem/1.0",
            "name": "Resource",
            "label": "Workspace",
            "type": 5,
            "isRequired": true,
            "value": "value::1",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.operationalinsights/workspaces": true
              },
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false
            }
          }
        ],
        "style": "above",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "Parameters"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "9bd54326-1969-4acf-8b19-30ca2911e2f1",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Health",
            "subTarget": "Health",
            "style": "link"
          },
          {
            "id": "95790351-6000-4fdb-b16f-8c51b06443e9",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Usage",
            "subTarget": "Usage",
            "style": "link"
          },
          {
            "id": "2f71730e-c97b-4869-bb67-61e0f136da00",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Agents Health",
            "subTarget": "Agents Health",
            "style": "link"
          },
          {
            "id": "f2e130e4-7046-4577-adec-f9498f2b7348",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Query Audit",
            "subTarget": "Query Audit",
            "style": "link"
          },
          {
            "id": "9ec18509-4326-4200-8ae1-033a0bf92928",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Settings & Change log",
            "subTarget": "Settings & Change log",
            "style": "link"
          }
        ]
      },
      "name": "Workbook tabs"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where '{Resource:name}' has name\r\n| extend state = trim(' ', tostring(properties.provisioningState))\r\n\t\t,sku   = trim(' ', tostring(properties.sku.name))\r\n        ,skuUpdate = trim(' ', tostring(properties.sku.lastSkuUpdate))\r\n\t\t,retentionDays = trim(' ', tostring(properties.retentionInDays))\r\n\t\t,dailyquotaGB  = trim(' ', tostring(properties.workspaceCapping.dailyQuotaGb))\r\n| extend dailyquotaGB = iif(dailyquotaGB !=-1.0, dailyquotaGB,\"Not set\")\r\n| extend skuUpdate    = iif(strlen(skuUpdate) > 0, skuUpdate,\"Unknown\")\r\n| extend sentinel     = iif(toint(retentionDays) < 90,\"If you have Sentinel, you can change your retention to 90days (free)?\",\"\")\r\n| project ['Resource Group']=resourceGroup, location, ['Data Retention(days)']=retentionDays, ['Last known SKU update']=skuUpdate, ['Daily Data Cap']=dailyquotaGB, ['Licence']=sku, ['Notes'] = sentinel",
        "size": 4,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "visualization": "table",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Workspace Name"
          },
          "leftContent": {
            "columnMatch": "Resource Group"
          },
          "rightContent": {
            "columnMatch": "Daily Data Cap"
          },
          "secondaryContent": {
            "columnMatch": "Licence"
          },
          "showBorder": false,
          "size": "auto"
        },
        "graphSettings": {
          "type": 0
        },
        "mapSettings": {
          "locInfo": "AzureLoc",
          "labelSettings": "location",
          "locInfoColumn": "location"
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Settings & Change log"
      },
      "name": "Workspace settings"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage\r\n| where TimeGenerated {TimeRange:query}\r\n| project TimeGenerated, DataType, Solution, Quantity\r\n| summarize IngestionVolume=sum(Quantity), TimeSinceLastUpdate=(now()-max(TimeGenerated))/1s by Solution, DataType\r\n| sort by Solution asc, DataType asc",
              "size": 0,
              "showAnalytics": true,
              "title": "Workspace Tables ({TimeRange:label})",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "DataType",
              "exportParameterName": "Table",
              "exportDefaultValue": "",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Solution",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Volume",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 38,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "TimeSinceLastUpdate",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 0
                      }
                    }
                  }
                ],
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "Solution"
                  ],
                  "expandTopLevel": true
                },
                "labelSettings": [
                  {
                    "columnId": "DataType",
                    "label": "Type"
                  },
                  {
                    "columnId": "IngestionVolume",
                    "label": "Ingestion Volume"
                  },
                  {
                    "columnId": "TimeSinceLastUpdate",
                    "label": "Time Since Last Update"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Usage"
            },
            "name": "BillableTablesVolume"
          },
          {
            "type": 1,
            "content": {
              "json": "Select a row in the table above for detailed info",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "Table",
              "comparison": "isEqualTo"
            },
            "name": "SelectUsageRow"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "  {Table}: Detailed Usage Data ({TimeRange:label})",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{Table}\r\n| where TimeGenerated {TimeRange:query}\r\n| summarize LogCount=count() by bin(TimeGenerated, {TimeRange:grain})\r\n",
                    "size": 1,
                    "aggregation": 3,
                    "showAnalytics": true,
                    "title": "Logs Count",
                    "color": "blue",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "Namespace",
                    "exportParameterName": "Namespace",
                    "exportDefaultValue": "All",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "Type",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "count_",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "Ingested Logs Count"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{Table}\r\n| where TimeGenerated {TimeRange:query}\r\n| summarize BillableDataMB =sum(_BilledSize) by bin(TimeGenerated, {TimeRange:grain})\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Ingestion Volume (MB)",
                    "color": "greenDark",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "areachart"
                  },
                  "customWidth": "50",
                  "name": "Ingestion volume"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{Table}\r\n| summarize ['Log Count']=count() by Resource=_ResourceId\r\n| sort by ['Log Count'] desc",
                    "size": 3,
                    "title": "Log Count by Resource",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 100
                    }
                  },
                  "name": "Log Count By Resource"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Table",
              "comparison": "isNotEqualTo"
            },
            "name": "Usage By Type"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Usage"
      },
      "name": "Usage"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "<svg viewBox=\"0 0 16 16\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path d=\"M2.78 8.15h-.31l5.72 5.47 4.49-4.69h1.41L8.22 15 1.31 8.44a3.78 3.78 0 0 1-.49-.57 3.64 3.64 0 0 1-.38-.66h1.89l2.17-2.3 3.57 3.42 2.45-2.55L11.75 7l2.78-.06a3.41 3.41 0 0 0 .36-.94 3.11 3.11 0 0 0 .11-.87 3.06 3.06 0 0 0-.28-1.26 3.32 3.32 0 0 0-.72-1A3.27 3.27 0 0 0 11.68 2a3.24 3.24 0 0 0-1.16.23 4.12 4.12 0 0 0-.92.56 7.39 7.39 0 0 0-.81.78c-.26.29-.52.59-.8.89q-.43-.46-.84-.85a8.31 8.31 0 0 0-.85-.75 3.81 3.81 0 0 0-1-.54 2.86 2.86 0 0 0-1.16-.2 3.31 3.31 0 0 0-1.25.28 3.37 3.37 0 0 0-1 .72 3.2 3.2 0 0 0-.67 1A3.14 3.14 0 0 0 1 5.43a3.4 3.4 0 0 0 .11.76h-1A2.38 2.38 0 0 1 0 5.84v-.38a4.25 4.25 0 0 1 1.18-3 4.19 4.19 0 0 1 3-1.31 3.82 3.82 0 0 1 1.16.13 4.19 4.19 0 0 1 .95.38 6 6 0 0 1 .84.61c.27.24.55.51.84.79.28-.3.55-.57.81-.82a5.37 5.37 0 0 1 .81-.65 4.23 4.23 0 0 1 .94-.43A4 4 0 0 1 11.66 1a4.07 4.07 0 0 1 1.66.29 4.14 4.14 0 0 1 1.36.88 4.34 4.34 0 0 1 .94 1.32 4.32 4.32 0 0 1 .38 1.6 4.18 4.18 0 0 1-.24 1.48A4.12 4.12 0 0 1 15 7.88L11.35 8l-.8-.78L8.1 9.75 4.53 6.32z\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\">Resourch Health (not affected by the Time Range)\r\n</span> "
            },
            "customWidth": "50",
            "name": "Resource health title",
            "styleSettings": {
              "margin": "25px 0px -10px 0px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureHealthQuery/1.0\",\"queryType\":\"Detailed\"}",
              "size": 3,
              "queryType": 4,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Name",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Availability state",
                    "formatter": 11
                  },
                  {
                    "columnMatch": "Detailed status",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Reason type",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Title",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource group",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 5
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "Availability state",
                    "label": "Availability State"
                  },
                  {
                    "columnId": "Detailed status",
                    "label": "Detailed Status"
                  },
                  {
                    "columnId": "Occurred time",
                    "label": "Occurred Time"
                  },
                  {
                    "columnId": "Reason chronicity",
                    "label": "Reason Chronicity"
                  },
                  {
                    "columnId": "Reason type",
                    "label": "Reason Type"
                  },
                  {
                    "columnId": "Reported time",
                    "label": "Reported Time"
                  },
                  {
                    "columnId": "Resource group",
                    "label": "Resource Group"
                  }
                ]
              }
            },
            "name": "ResourceHealth",
            "styleSettings": {
              "margin": "0px 0px 0px 30px"
            }
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "586286ff-0691-4610-b38f-c33d548503d7",
                  "cellValue": "{Resource}",
                  "linkTarget": "Resource",
                  "linkLabel": "Resource Health page >",
                  "subTarget": "resourcehealth",
                  "style": "link"
                }
              ]
            },
            "name": "ResourceHealthLink",
            "styleSettings": {
              "margin": "0px 0px 0px 30px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "_LogOperation\r\n| where Level in (\"Error\", \"Warning\") and Category != \"Agent\"\r\n| summarize arg_max(TimeGenerated, *) by Level, Resource=_ResourceId, Computer, Category, Operation, Detail\r\n//| project TimeGenerated, Level, _ResourceId, Computer, Category, Operation, Detail\r\n| sort by TimeGenerated desc\r\n\r\n//Operation\r\n//| where OperationStatus in (\"Warning\", \"Error\")\r\n//| summarize arg_max(TimeGenerated, *) by Level=OperationStatus, _ResourceId, Computer, Category=OperationCategory, Detail\r\n//| sort by TimeGenerated asc",
              "size": 3,
              "showAnalytics": true,
              "title": "Operational Errors and Warnings ({TimeRange:label})",
              "noDataMessage": "No errors or warnings",
              "noDataMessageStyle": 3,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Warning",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Error",
                          "representation": "3",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "80ch"
                    },
                    "tooltipFormat": {
                      "tooltip": "{0}"
                    }
                  },
                  {
                    "columnMatch": "Level",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Detail",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 5
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "Level",
                    "Detail"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "TimeGenerated"
                },
                "sortBy": [
                  {
                    "itemKey": "Computer",
                    "sortOrder": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "Detail",
                    "label": "Details"
                  },
                  {
                    "columnId": "TimeGenerated",
                    "label": "Time"
                  },
                  {
                    "columnId": "CorrelationId"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Computer",
                  "sortOrder": 1
                }
              ]
            },
            "name": "TopOperationalErrorsAndWarnings"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "706104b9-fcf6-4d26-a3b7-698dead99daa",
                  "cellValue": "https://portal.azure.com/#blade/Microsoft_Azure_Monitoring_Logs/LogsBlade/resourceId/%2Fsubscriptions%2F{Resource:subscriptionId}%2FresourceGroups%2F{Resource:resourcegroup}%2Fproviders%2FMicrosoft.OperationalInsights%2Fworkspaces%2F{Resource:label}/source/LogsBlade.AnalyticsShareLinkToQuery/q/H4sIAAAAAAAAA6XOSwrCMBgE4L3gHcasVHIFF1JFBEEQwWWJ7RAjTVL%252Bpr7w8FqEgm5dD%252FPN5JtotzXFJBfDcPDE9UQhNrywggsYq6VIFKWhDkaCC1ZNYEKJzCTaKHeMZlBzy5BUV29a7424B2HE5t7cxnvnuWLoJlhqTCc43j%252B%252BRr5jE1spuH4nWfR1myi6tzX6axoLJuOqbqOWeGaR8CP%252FZTZRUnfsy0TJpngBxTpLCSIBAAA%253D/timespan/P1D",
                  "linkTarget": "Url",
                  "linkLabel": "_LogOperation",
                  "style": "link"
                }
              ]
            },
            "name": "OperationsTableLink",
            "styleSettings": {
              "margin": "0px 0px 0px 30px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": " \r\n ---\r\n"
            },
            "customWidth": "100",
            "name": "Separator line",
            "styleSettings": {
              "margin": "25px 0px -10px 0px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let TotalIngestion=toscalar(\r\nUsage\r\n| where TimeGenerated {TimeRange:query}\r\n| summarize IngestionVolume=sum(Quantity));\r\nUsage\r\n| where TimeGenerated {TimeRange:query}\r\n| project TimeGenerated, DataType, Solution, Quantity\r\n| summarize IngestionPercent=(sum(Quantity))/TotalIngestion by Solution, DataType\r\n| sort by Solution asc, DataType asc",
              "size": 0,
              "showAnalytics": true,
              "title": "Select a type to review ingestion latency ({TimeRange:label})",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "DataType",
              "exportParameterName": "SelectedType",
              "exportDefaultValue": "",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Resource}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Solution",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "IngestionPercent",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "yellowOrangeRed"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "percent",
                        "useGrouping": false,
                        "maximumFractionDigits": 1
                      }
                    }
                  }
                ],
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "Solution"
                  ],
                  "expandTopLevel": true
                },
                "labelSettings": [
                  {
                    "columnId": "Solution"
                  },
                  {
                    "columnId": "DataType",
                    "label": "Type"
                  },
                  {
                    "columnId": "IngestionPercent",
                    "label": "Percentage of total ingestion"
                  }
                ]
              }
            },
            "name": "IngestionTablesList"
          },
          {
            "type": 1,
            "content": {
              "json": "Select a row in the table above for detailed info",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedType",
              "comparison": "isEqualTo"
            },
            "name": "Select a data type text"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "#### Ingestion Latency ({TimeRange:label})\r\n*excluding Usage and Custom logs"
                  },
                  "name": "IngestionLatencyTitle"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{SelectedType}\r\n| where TimeGenerated {TimeRange:query}\r\n| extend IngestionDurationSeconds = (ingestion_time()-TimeGenerated)/1s \r\n| summarize ['Median ingestion time (seconds)']=percentiles(IngestionDurationSeconds, 50), ['90th % ingestion time (seconds)']=percentiles(IngestionDurationSeconds, 90) by bin(TimeGenerated, {TimeRange:grain})\r\n| render timechart\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "showAnalytics": true,
                    "title": "{SelectedType}: Ingestion Time (seconds)",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Median Latency (seconds)",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redDark"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "90th Percentile Latency (seconds)",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "red"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 9,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Median Ingestion (seconds)",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redDark"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "90th Percentile Ingestion time (seconds)",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "red"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        }
                      ]
                    }
                  },
                  "name": "Ingestion latency 90th percentile by data type",
                  "styleSettings": {
                    "margin": "30px"
                  }
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "adfc4e1e-0bbe-4ea8-939d-e70911498cc2",
                        "version": "KqlParameterItem/1.0",
                        "name": "IngestionPercentile",
                        "label": "Show ingestion percentile:",
                        "type": 10,
                        "description": "Show ingestion latency for the selected percentile. For example, selecting 99 will show the ingestion latency measured in the top 1 percent of requests",
                        "isRequired": true,
                        "value": "95",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[50,90,95]",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "formHorizontal",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "IngestionLatencyPercentile",
                  "styleSettings": {
                    "margin": "0px 0px 0px 10px"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Agent latency\r\n{SelectedType}\r\n| extend AgentLatencySeconds = (_TimeReceived-TimeGenerated)/1s,\r\n         PipelineLatencySeconds = (ingestion_time()-_TimeReceived)/1s\r\n| summarize ['{IngestionPercentile}th % PipeLine latency'] = percentiles(PipelineLatencySeconds, {IngestionPercentile}),\r\n            ['{IngestionPercentile}th % Agent latency'] = percentiles(AgentLatencySeconds, {IngestionPercentile})\r\n   by bin(TimeGenerated, {TimeRange:grain})\r\n| render barchart kind=stacked",
                    "size": 1,
                    "aggregation": 3,
                    "showAnalytics": true,
                    "title": "{SelectedType}: Agent and Pipeline (seconds)",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Median Agent Latency (seconds)",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "90th Percentile Agent Latency (seconds)",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "magenta"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 9,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ]
                    },
                    "chartSettings": {
                      "showLegend": true,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "90th % PipeLine latency",
                          "color": "green"
                        },
                        {
                          "seriesName": "90th % Agent latency",
                          "color": "grayBlue"
                        },
                        {
                          "seriesName": "50th % PipeLine latency",
                          "color": "green"
                        },
                        {
                          "seriesName": "50th % Agent latency",
                          "color": "grayBlue"
                        },
                        {
                          "seriesName": "95th % PipeLine latency",
                          "color": "green"
                        },
                        {
                          "seriesName": "95th % Agent latency",
                          "color": "grayBlue"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 24,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "Agent latecy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "SelectedType",
              "comparison": "isNotEqualTo"
            },
            "name": "Health by type"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Health"
      },
      "name": "Health"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| summarize Average=avg(ResponseDurationMs), Maximum=max(ResponseDurationMs), Median=percentiles(ResponseDurationMs, 50) by bin(TimeGenerated,{TimeRange:grain})\r\n| render timechart",
              "size": 1,
              "title": "Query Duration (ms)",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Resource}"
              ]
            },
            "name": "QueryDuration"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| summarize Average=avg(ResponseRowCount), Maximum=max(ResponseRowCount), Median=percentiles(ResponseRowCount, 50) by bin(TimeGenerated, {TimeRange:grain})\r\n| render timechart",
              "size": 1,
              "title": "Number of Rows Returned",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Resource}"
              ]
            },
            "name": "QueryRows"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| summarize count() by tostring(ResponseCode)\r\n| render piechart",
              "size": 3,
              "title": "Response Codes",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Resource}"
              ]
            },
            "customWidth": "50",
            "name": "ResponseCodes"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| top-hitters 20 of QueryText by ResponseDurationMs\r\n| extend idx = indexof(QueryText,split(QueryText,\";\")[2])\r\n| extend purequerytext= substring(QueryText,idx)\r\n| project-away QueryText, idx",
              "size": 3,
              "title": "Top 20 slowest queries",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Resource}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "approximate_sum_ResponseDurationMs",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "orange"
                    }
                  },
                  {
                    "columnMatch": "purequerytext",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true,
                      "customColumnWidthSetting": "160ch"
                    }
                  },
                  {
                    "columnMatch": "QueryText",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "approximate_sum_ResponseDurationMs",
                    "label": "Response Duration (ms)"
                  },
                  {
                    "columnId": "purequerytext",
                    "label": "Query Text"
                  }
                ]
              }
            },
            "name": "SlowestQueries"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| top 10 by StatsCPUTimeMs desc nulls last\r\n| extend purequerytext= split(QueryText, \";\")[2]\r\n| extend idx = indexof(QueryText,split(QueryText,\";\")[2])\r\n| project StatsCPUTimeMs, StatsDataProcessedKB, substring(QueryText,idx)",
              "size": 3,
              "showAnalytics": true,
              "title": "Top 10 resource intensive queries ",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Resource}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "StatsCPUTimeMs",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redBright"
                    }
                  },
                  {
                    "columnMatch": "Column1",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "purequerytext",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "160ch"
                    }
                  },
                  {
                    "columnMatch": "approximate_sum_ResponseDurationMs",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redBright",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "QueryText",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "StatsCPUTimeMs",
                    "label": "CPU Time (ms)"
                  },
                  {
                    "columnId": "StatsDataProcessedKB",
                    "label": "Data Processed (KB)"
                  },
                  {
                    "columnId": "Column1",
                    "label": "Query Text"
                  }
                ]
              }
            },
            "name": "ResourceIntensiveQueries "
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| summarize count() by AADEmail\r\n| top 10 by count_\r\n",
              "size": 3,
              "showAnalytics": true,
              "title": "Queries by user",
              "timeContext": {
                "durationMs": 86400000
              },
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "50",
            "name": "QueriesByUser"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| where ResponseCode == \"429\"\r\n| summarize reqCount = count() by AADObjectId\r\n| order by reqCount desc",
              "size": 3,
              "showAnalytics": true,
              "title": "Throttled users (TimeRange:label)",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Resource}"
              ]
            },
            "customWidth": "50",
            "showPin": true,
            "name": "ThrottledUsers"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Query Audit"
      },
      "name": "QueryAudit"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Computers that sent heartbeats over 5 minutes ago\nlet Trend=\nHeartbeat\n| make-series HeartbeatsTrend=count() on TimeGenerated from ({TimeRange:start}) to ({TimeRange:end}) step ({TimeRange:grain}) by _ResourceId\n;\nHeartbeat\n| summarize TimeSinceLastHeartbeatSeconds=(now()-max(TimeGenerated))/1s by _ResourceId, Name=Computer, OSType, SubscriptionId, ResourceGroup\n| where TimeSinceLastHeartbeatSeconds > 60\n| join kind=inner (Trend) on _ResourceId\n| project _ResourceId, Name, OSType, TimeSinceLastHeartbeatSeconds, HeartbeatsTrend, SubscriptionId, ResourceGroup\n| sort by TimeSinceLastHeartbeatSeconds desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Computers missing heartbeats",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeSinceLastHeartbeat",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redBright"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 0
                      }
                    }
                  },
                  {
                    "columnMatch": "Heartbeats",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "green"
                    }
                  },
                  {
                    "columnMatch": "SubscriptionId",
                    "formatter": 5
                  }
                ],
                "rowLimit": 100,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "SubscriptionId"
                  ],
                  "expandTopLevel": true
                },
                "labelSettings": [
                  {
                    "columnId": "_ResourceId",
                    "label": "Computer"
                  },
                  {
                    "columnId": "OSType",
                    "label": "OS Type"
                  },
                  {
                    "columnId": "TimeSinceLastHeartbeatSeconds",
                    "label": "Time since last heartbeat"
                  },
                  {
                    "columnId": "HeartbeatsTrend",
                    "label": "Heartbeat trend"
                  },
                  {
                    "columnId": "SubscriptionId",
                    "label": "Subscription ID"
                  },
                  {
                    "columnId": "ResourceGroup",
                    "label": "Resource group"
                  }
                ]
              },
              "sortBy": []
            },
            "name": "Computers missing heartbeats"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Agents Health"
      },
      "name": "Computers missing heartbeats"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}